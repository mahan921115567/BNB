
<div class="flex flex-col h-[75vh] bg-gray-100 dark:bg-gray-800/50 rounded-2xl overflow-hidden border border-gray-200 dark:border-gray-700/50">
    <!-- Header -->
    <header class="p-4 bg-white/50 dark:bg-gray-900/50 backdrop-blur-md border-b border-gray-200 dark:border-gray-700/50 text-center">
        <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200">پشتیبانی آنلاین</h2>
        <p class="text-xs text-gray-500 dark:text-gray-400">سوالات و مشکلات خود را با ما در میان بگذارید</p>
    </header>

    <!-- Messages -->
    <main #chatContainer class="flex-grow p-4 space-y-4 overflow-y-auto">
        @if (messages().length === 0) {
            <div class="flex flex-col items-center justify-center h-full text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                <p>هنوز پیامی ارسال نشده است.</p>
            </div>
        } @else {
            @for (msg of messages(); track msg.id) {
                <div class="flex" [class.justify-end]="msg.sender === 'user'" [class.justify-start]="msg.sender === 'expert'">
                    <div class="max-w-xs md:max-w-md p-3 rounded-2xl" 
                         [class.bg-amber-400]="msg.sender === 'user'" 
                         [class.text-black]="msg.sender === 'user'" 
                         [class.rounded-br-lg]="msg.sender === 'user'"
                         [class.bg-white]="msg.sender === 'expert'"
                         [class.dark:bg-gray-700]="msg.sender === 'expert'"
                         [class.rounded-bl-lg]="msg.sender === 'expert'">
                        <p class="text-sm leading-relaxed">{{ msg.text }}</p>
                        <p class="text-xs mt-2 opacity-70 text-right">{{ msg.timestamp | date:'HH:mm' }}</p>
                    </div>
                </div>
            }
        }
    </main>

    <!-- Input -->
    <footer class="p-4 bg-white/50 dark:bg-gray-900/50 backdrop-blur-md border-t border-gray-200 dark:border-gray-700/50">
        <form (ngSubmit)="sendMessage()" class="flex items-center gap-2">
            <input 
                type="text" 
                [(ngModel)]="newMessage"
                name="newMessage"
                placeholder="پیام خود را بنویسید..."
                class="w-full p-3 bg-gray-200 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-amber-400 outline-none transition-all">
            <button 
                type="submit" 
                [disabled]="!newMessage().trim()"
                class="bg-amber-400 hover:bg-amber-500 text-black font-bold p-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
            </button>
        </form>
    </footer>
</div>
